---
title: "antibiotics"
date: "`r format(Sys.Date())`"
author:
- Douglas Campbell^1^*
- Carlie Barnhill^1^*
- Ruby Muzzatti^1^*
output:
  bookdown::html_document2:
    code_folding: show
    keep_md: yes
    toc: TRUE
    toc_float: TRUE
    toc_depth: 6
    fig_caption: yes
bibliography: RPackageCitations.bib
csl: plos-one.csl
editor_options: 
  markdown: 
    wrap: 72
---
```{css, echo=FALSE}
p.caption {
  font-size: 18px;
}
```


# Affiliations {-}
^1^Mount Allison University, New Brunswick, Canada  

*corresponding author  

# Acknowledgements {-}
Brackets minus after heading excludes heading from numbering.
DAC was supported by the Canada Research Chairs.

# Overview
File import functions read files into R objects, commonly data frames.
I love github

Things Kingsley will do

Relative abundance of colonies by flow type (inflow vs. outflow).
Relative abundance of colonies by antibiotics.
Combined abundance of colonies by flow type and antibiotics (stacked or grouped).
Interpretation
Inflow vs. Outflow: This will show whether the colony abundance is higher in the inflow or the outflow of your sample.

Antibiotic Comparison: You will observe which antibiotic showed higher or lower bacterial counts, reflecting relative resistance or susceptibility.

Combined abundance: This will show a detailed breakdown of colony abundance for each antibiotic within inflow and outflow categories.

Note, Kingsley is excluding the colonies in a  lawn becaause  a lawn contains infinity number of colonies

# Materials & Methods  
## Set chunk options
Formatted display of content from .md file on GitHub site.
Upon knitr figures will be saved to 'Figs/'
```{r setup, include=FALSE}
knitr::opts_chunk$set(warning = FALSE, error = FALSE, message = FALSE)
knitr::opts_chunk$set(fig.path='Figs/')
```

## Load packages
```{r packages, include = FALSE}
library(tidyverse) #core packages from Tidyverse
library(googledrive) #access to GoogleDrive
library(googlesheets4) #access to GoogleSheets
##library(data.table) #fast data handling;  complement to tidverse dplyr
##library(lubridate) #tidyverse handling dates & times
```

## InLine Citations of software packages added through the 'citr' option under 'Addins'.  
The cited items must be in the .bib file saved in the .Rproj folder; in this case RPackageCitations.bib, generated by exporting a library to .bib from Zotero.  Upon export click the 'Keep Updated' button in the BetterBibTex menu.  If new citations are added to Zotero they will be pushed through to update the exported .bib file in the .Rproj folder.
[@bryanGooglesheets4AccessGoogle2021;@mcgowanGoogledriveInterfaceGoogle2020; @wickhamTidyverseEasilyInstall2017]

## Source locally saved functions stored in a text file
A text file of functions is a preliminary step towards a package, to re-use functions without repasting them.



## Set Project Variables  
Try to set all user-defined variables near top of .Rmd, in one place, to avoid or limit editing of downstream code.
Assigning project-specific values to generic variables helps with re-use of code.



# Import MetaData from a GoogleSheet
MetaData in a GoogleSheet is more generic than a project-specific .csv edited and saved locally.
The GoogleSheet interface can be tricky.
Repeatedly reading from GoogleDrive can provoke a throttle from Google.
```{r load Catalog direct from googlesheet, results = "hide"}


#Instead of sending a token, googlesheets4 will send an API key. This can be used to access public resources for which no Google sign-in is required. 
googlesheets4::gs4_deauth()



#URL or ID of a GoogleSheet readable by anyone (with a link)
MetaData <- googlesheets4::read_sheet("https://docs.google.com/spreadsheets/d/1J6Ip_VzQCpMvZSZFiQVm0LSXW6wn2uSi7_NohkacjJ0/edit?gid=0#gid=0", sheet = "MetaData")

DataSheet <- googlesheets4::read_sheet("https://docs.google.com/spreadsheets/d/1J6Ip_VzQCpMvZSZFiQVm0LSXW6wn2uSi7_NohkacjJ0/edit?gid=0#gid=0", sheet = "Data")
  # googlesheets4::read_sheet has a  "feature" to set the type of columns it can't parse to a list.
  # ggplot/dplyr does not like working with a dataframe of lists.
  # In this case variable column WL is set to a list since some values are numbers, some are strings, some are blank.
  # To fix this, first drop all rows missing WL, then unlist.
  # Must first drop NA rows since unlist will collapse NULL lists, then the unlisted WL is a shorter length than original WL column, which mutate does not like.
   #same link, updated data in it


#Catalog <- as.data.frame(Catalog) %>%
  #mutate(ExpDate = lubridate::ymd(ExpDate))
```
# Merged  DataSheet with MetaData by the value of PlateID
```{r}
DataMeta <- left_join(x  = DataSheet, y = MetaData, by = "PlateID")
```



```{r}
# Relative abundance for FlowType and Antibiotic
 flow_antibiotic_relative <- DataMeta %>%
filter(!is.na(InOut))%>%
  group_by(Antibiotic, InOut)%>%
    summarise(TotalCount = sum(Colony_Number, na.rm = TRUE)) %>%
  ungroup()
                               
                               
       #                        , .by = c() , ))%>%
     #mutate(RelativeAbundance = (TotalCount / sum(TotalCount)) * 100)
```

```{r}
flow_antibiotic_relative %>%
  ggplot()+
  geom_bar(aes(x = Antibiotic, y = TotalCount, colour = InOut, fill = InOut ), stat = "identity")
```




#Results, Ruby
Attempting to pull in IMG_2381.jpeg from 2024_10_28 folder
```{r}
knitr::include_graphics("IMG_2381.jpeg")
```
October 25, 2024: Opaque cream colour lawn is seen in Ampicillin Out 2 (a and b), Out 3 (a, b, c), Out 1 (a, b, c). Semi opaque cream colour lawn in Ampicillin Out 2 (c), In 2 (a, b), In 1 (a, b, c), In 3 (a, b, c).

\newpage

# Bibliography